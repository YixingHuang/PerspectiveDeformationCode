# PerspectiveDeformationCode
 Code and data for perspective deformation correction in X-ray transmission imaging


 # Additional information for Experimental Setup

 ## Numerical bead phantoms
3D bead phantoms are generated to demonstrate the efficacy of our proposed algorithms for general perspective deformation learning. Each bead phantom is a cylinder containing spherical beads. The height and diameter of the cylinder are randomly generated, with values of $240 \pm 16$\,mm and $225 \pm 32$\,mm respectively. The background intensity value of the cylinder is a random value of $50\pm 35$\,HU.  Small and big beads have the sizes of $6.4 \pm 1.6$\,mm and $16 \pm 8$\,mm, respectively. Their intensities are either $3500 \pm 350$\,HU or $6000 \pm 1000$\,HU. The phantoms have a size of $512\,\times\,512\,\times\,512$ voxels with a voxel size of $0.625\,\times\,0.625\,\times\,0.625\,\text{mm}^3$. 200 bead phantoms are generated, with 185 phantoms for training, 5 phantoms for validation, and 10 phantoms for testing. Each phantom in the dataset contains approximately 50 spherical beads with random positions inside the cylinder. Note that the number of beads also varies randomly in the same data set. 
%In BeadData III, due to the large number of beads, the bead-to-bead correspondence between different views is very difficult to determine. Therefore, learning perspective deformation is the most challenging for BeadData III among the three data sets.

For data augmentation, each phantom is rotated by $15^\circ$, $30^\circ$, $\dots$, $75^\circ$. This is equivalent to acquire projection data from the view angles of $15^\circ$, $30^\circ$, $\dots$, $75^\circ$. Hence, for each original phantom, six orthogonal projection images with their corresponding $0^\circ$, $90^\circ$, and $180^\circ$ perspective projections images are acquired. This augmentation is applied to the training, validation, and test phantoms.

The projection images in Cartesian coordinates have an image size of $512 \times 512$ with a pixel size of $0.625\,\text{mm}\,\times\,0.625\,\text{mm}$. Images in polar coordinates have an image size of $512 \times 512$ with a pixel size of $0.375\,\text{mm}\,\times\,0.703^\circ$. Images in log-polar coordinates have an image size of $512 \times 512$ with an angular spacing of $0.703^\circ$ and an initial radial spacing of 0.0075\,mm. For display, the integral intensity range of [0, 6] in projection images is linearly converted to [0, 255] (the same for the following chest and head data).

For simulation studies on bead phantom data, a cone beam computed tomography (CBCT) system with a source-to-detector distance ($D_{\text{sd}}$) of 1200\,mm and a source-to-isocenter distance ($D_{\text{si}}$) of 750\,mm is used, which represents a common configuration for floor mounted C-arm CBCT systems. The detector has $1240\,\times\,960$ pixels with a pixel size of $0.308\,\times\,0.308\,\text{mm}^2$. Acquired projection images are rebinned to a virtual detector at the isocenter, which has $512\,\times\,512$ pixels with a pixel size of $0.625\,\times\,0.625\,\text{mm}^2$. In practice, higher pixel resolution for the virtual detector is achievable. Here a coarse resolution of $0.625\,\times\,0.625\,\text{mm}^2$ is used as a proof of concept. The volume centers of imaged objects are located at the world coordinate origin. Perspective projections are generated via forward projection of the volumes. The orthogonal projections are generated using a large virtual source-to-detector distance of 12000\,mm and a short isocenter-to-detector distance of 100\,mm.
